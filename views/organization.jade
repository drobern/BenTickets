extends layout
block content
  head
  script(src="https://www.google.com/jsapi")
  script(src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js")
  script(src="http://code.jquery.com/ui/1.10.3/jquery-ui.js")
  link(rel="stylesheet", href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css")
  link(rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css")
  link(rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css")
  script(src="//netdna.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js")
  meta(name='description', content='Benbria Support Tickets')
  script.
    
    // Load the Visualization API and the piechart package.
    google.load('visualization', '1', {'packages':['table']});
      
    // Set a callback to run when the Google Visualization API is loaded.
    google.setOnLoadCallback(drawTable);

      
    function drawTable() {
      var gd = !{JSON.stringify(gd)};
      console.log(gd); 
      
      var chart = new google.visualization.DataTable(gd); 
      
      if (gd) {

        var table = new google.visualization.Table(document.getElementById('chart_div'));
        table.draw(chart, {showRowNumber: false});

        // Add event if user clicks a ticket in row
        google.visualization.events.addListener(table, 'select', function() {
          var row = table.getSelection()[0].row;
          window.open("ticket?id="+chart.getValue(row, 0),"_self");
        });
      } else {
        $('#chart_div').text("NO TICKETS FOUND FOR YOUR LOCATION");
      }
    }
  body
    nav.navbar.navbar-default.navbar-inverse.navbar-fixed-top(role="navigation")

      // Brand and toggle get grouped for better mobile display
      .navbar-header
        button(type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse")
          span.sr-only Toggle navigation
          span.icon-bar
          span.icon-bar
          span.icon-bar
        a.navbar-brand(href="create") CREATE A TICKET
        

      // Collect the nav links for toggling
      .collapse.navbar-collapse.navbar-ex1-collapse
        ul.nav.navbar-nav.navbar-center
          li.dropdown
            a(href="#" class="dropdown-toggle" data-toggle="dropdown") Forums
              b.caret
            ul.dropdown-menu
              li
                a(href="KnowledgeBase") Forum Topics
              li
                a(href="topicAdd") Add a Topic
          li.dropdown
            a(href="#" class="dropdown-toggle" data-toggle="dropdown") Tickets
              b.caret
            ul.dropdown-menu
              li.active
                a(href="#") View Tickets
              li
                a(href="create") Create a New Ticket
          li.dropdown
            a(href="#" lass="dropdown-toggle" data-toggle="dropdown") Settings
              b.caret
            ul.dropdown-menu
              li
                a(href="changePass") Change Password
              li
                a(href="select") Change Organization
              li
                a(href="index") Log Out
        img#benbria.nav.navbar-nav.navbar-right(src="img/benbria_logo.png", hieght="100", width="100", alt="Benbria Logo")
    .jumbotron
      h1.titre Tickets for Organization: #{orgname} 
    .container
      form.form-inline(action="/searchRequest",method="post",enctype="multipart/form-data" role="form")
        div(align="right")
          .form-group
            input.form-control(type="text" id="inputSearch" name="search" placeholder="Search Your Tickets" value=search) 
          button.btn.btn-primary Search
      div#chart_div
      center
        nav
          - if (page != 1 || page < pageNum) {
            - console.log('PAGE: '+page+' TOTAL: '+pageNum);
            ul.pagination
              - if (page == 1) {
              li.disabled 
                a(href="#")
                  span(aria-hidden="true") &laquo;
                  span.sr-only Previous
              - } else {
              li
                a#previous(href="organization?id="+organization)
                  span(aria-hidden="true") &laquo;
                  span.sr-only Previous
              - }
              li.active
                a(href="#")
                  div(id='page') 
                  span.sr-only (current)
              - if ((page + 1) <= pageNum) {
                li
                  a#page2(href="organization?id="+organization) 
                    div(id='page2')
              -}
              - if ((page + 2) <= pageNum) {
                li
                  a#page3(href="organization?id="+organization)
                    div(id='page3')
              -}
              - if ((page + 3) <= pageNum) {
                li
                  a#page4(href="organization?id="+organization)
                    div(id='page4')
              -}
              - if ((page + 4) <= pageNum) {
                li
                  a#page5(href="organization?id="+organization)
                    div(id='page5')
              -}
              - if (page == pageNum) {
              li.disabled 
                a(href="#")
                  span(aria-hidden="true") &raquo;
                  span.sr-only Next
              - } else {
                li
                  a#next(href="organization?id="+organization)
                    span(aria-hidden="true") &raquo;
                    span.sr-only Next
              -}
          -}
    #contact 
      a.button(data-toggle="modal" href="#myModal") Contact Us

    div(id="myModal" class="modal fade in")
      .modal-dialog
        .modal-content
          .modal-header
            .button.close(data-dismiss="modal" aria-hidden="true") X
            .modal-title CONTACT US
          .modal-body
              a#tel(href='callto:613-271-5995') 613-271-5995
              br
              a#email(href='mailto:support@benbria.com?Subject=Benbria Support') support@benbria.com
          .modal-footer
              button.btn.btn-primary(data-dismiss="modal" aria-hidden="true") Close
    
    script.
      var previous = 1;
      var page = parseInt("#{page}");
      var pageNum = parseInt("#{pageNum}");
      var organization = ("#{organization}");
      var search = ("#{search}");
      console.log('WHAT PAGE IS SENT: '+page+' NUMBER OF PAGES: '+pageNum);
      
      if (page != 0) {
        previous= page -1;
        if (search) {
          $('#previous').attr('href', $('#previous').attr('href') + '&page=' + previous + '&search='+ search);
        } else {
          $('#previous').attr('href', $('#previous').attr('href') + '&page=' + previous);
        }
      }
      if (page <= pageNum) {
        page2 = page + 1;
        $('#page2').html(page2);
        if (search) {
          $('#page2').attr('href', $('#page2').attr('href') + '&page=' + page2 + '&search='+ search);
          $('#next').attr('href', $('#next').attr('href') + '&page=' + page2 + '&search='+ search);
        } else { 
          $('#page2').attr('href', $('#page2').attr('href') + '&page=' + page2);
          $('#next').attr('href', $('#next').attr('href') + '&page=' + page2);
        }         
        if (page2 < pageNum) {
          page3 = page2 +1;
          $('#page3').html(page3);
          if (search) {
            $('#page3').attr('href', $('#page3').attr('href') + '&page=' + page3+ '&search='+ search);
          } else {
            $('#page3').attr('href', $('#page3').attr('href') + '&page=' + page3);
          }
          if (page3 < pageNum) {
            page4 = page3 + 1;
            $('#page4').html(page4);
            if (search) {
              $('#page4').attr('href', $('#page4').attr('href') + '&page=' + page4+ '&search='+ search);
            } else {
              $('#page4').attr('href', $('#page4').attr('href') + '&page=' + page4);
            }
            console.log("PAGE 4: "+page4+" AND THE TOTAL AGAIN! "+pageNum);
            if (page4 <= pageNum) {
              page5 = page4+1;
              $('#page5').html(page5);
              if (search) {
                $('#page5').attr('href', $('#page5').attr('href') + '&page=' + page5+ '&search='+ search);
              } else {
                $('#page5').attr('href', $('#page5').attr('href') + '&page=' + page5);
              }
            }
          }
        }
      }
      $('#page').html(page);

      

      
    
      

